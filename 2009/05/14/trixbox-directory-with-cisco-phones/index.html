
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Trixbox directory with Cisco Phones - /home/jeff/blog</title>
  <meta name="author" content="jeff">

  
  <meta name="description" content="In case anyone may want to use Trixbox with Cisco 79xx phones and wants to use a directory with it, I have put together a hack to deal with the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jbuchbinder.com/2009/05/14/trixbox-directory-with-cisco-phones">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="/home/jeff/blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<meta property="fb:app_id" content="159544250739435" />


  
  <!-- Google Analytics -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-49191923-1', 'auto');  // Replace with your property ID.
  ga('send', 'pageview');

  </script>
  <!-- End Google Analytics -->


  <meta property="og:url" content="http://jbuchbinder.com/2009/05/14/trixbox-directory-with-cisco-phones/">
<meta property="og:type" content="website" />

<meta property="og:title" content="Trixbox directory with Cisco Phones">
<meta property="og:description" content="">
 


</head>

<body   >
  <!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MXV2JN"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MXV2JN');</script>
<!-- End Google Tag Manager -->

  <header role="banner"><hgroup>
  <h1><a href="/">/home/jeff/blog</a></h1>
  
    <h2>Sucking away valuable moments of your life ...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jbuchbinder.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/music">Music</a></li>
  <li><a href="/pets">Pets</a></li>
  <li><a href="/quotes">Quotes</a></li>
  <!-- <li><a href="/studio">Studio</a></li> -->
  <li><a href="/wishlist">Wishlist</a></li>
  <li><a href="/in-memoriam">In Memoriam</a></li>
  <li><a href="/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Trixbox Directory With Cisco Phones</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-05-14T00:00:00-04:00" pubdate data-updated="true"></time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>In case anyone may want to use Trixbox with Cisco 79xx phones and wants to use a directory with it, I have put together a hack to deal with the directory services, which nominally require SugarCRM, so that they report simple extensions back in the appropriate format.</p>

<p>1) In the Endpoint manager, make sure that the services URL and directory URL are in the default configuration for Cisco phones, and restart any phones which are running to activate the configuration.</p>

<p>2) In <code>/var/www/html/cisco/services</code>, make sure that index_cisco.php is symlinked to index.php</p>

<p>3) In <code>/var/www/html/cisco/services/DBConnect.inc</code>, change the default username and password to something with access to the asterisk database, and change the database name to <code>asterisk</code>.</p>

<p>4) Make <code>PhoneDirectory.php</code> in that directory contain:</p>

<pre><code>&lt; ?php

##########################################
# Config section

$Server = "http://$SERVER_ADDR/cisco/services";   # don't add a trailing slash!
$LongDistanceExtension = ""; # change this to match your config

##########################################
#
# Set content type
header("Content-Type: text/xml");

# This is the include file that establishes the connection to the MySQL database
require ("DBConnect.inc"); 

# This sets the offset for the LIMIT portion of the query
$NextStartingRow = $NextSet*30;

# Connect to the database
$ConnectionSuccess = db_connect();
if (!$ConnectionSuccess) exit;

# If the variable "ID" is passed in through the GET string, then display 
# extension, phone number and cell phone number for that record with the dial
# key functionality
if ($ID) {
        $PersonDirectoryListing = "n";

        //$Query  = "SELECT id, first_name, last_name, phone_home, phone_work, phone_mobile, phone_other ";
        //$Query .= "FROM contacts WHERE id = '$ID' ";
        //$Query .= "ORDER BY last_name "; 
        $Query  = "SELECT id,description FROM devices WHERE ( tech = 'sip' OR tech = 'iax' ) AND id = '".addslashes($ID)."' ";

        $SelectPersonInfo = mysql_query($Query,$ConnectionSuccess);

        while ($row = mysql_fetch_array($SelectPersonInfo)) {
                $WorkPhone = ereg_replace("[ ()-] ", "", $row['id']);

                $PersonDirectoryListing .= "n";
                $PersonDirectoryListing .= "Extension:n";
                //$PersonDirectoryListing .= "$LongDistanceExtension$WorkPhonen";
                $PersonDirectoryListing .= "$WorkPhonen";
                $PersonDirectoryListing .= "n";
        }

        $PersonDirectoryListing .= "n";

        echo "$PersonDirectoryListing";

# If the variable ID is not passed in on the GET string, then do the 
# entire company directory, unless last is passed in. If so then we
# will be using a LIKE filter in our SQL query
} else {
        $PersonNameList = "n";
        $PersonNameList .= "n";
        $PersonNameList .= "Please select onen";

        $Query  = "SELECT id,description FROM devices WHERE ( tech = 'sip' OR tech = 'iax' ) ";
        //$Query  = "SELECT id, first_name, last_name, phone_home, phone_work, phone_mobile, phone_other ";
        //$Query .= "FROM contacts WHERE deleted = 0 ";

        # If we are searching by last name the add this filter to the query
        if ($LastName) { $Query .= "and description like '%$LastName%' ";  }
        $Query .= "ORDER BY id ASC";

        # If this is the first page of the company directory then we will display the first 30
        if (!$NextSet) {
                $Query .= " Limit 0,30";
        # Now for each subsiquent call we get the next 30 records.
        } else {
                $Query .= " Limit $NextStartingRow,30";
        }

        # Execute the query
        //echo $Query;
        $SelectNameList = mysql_query($Query,$ConnectionSuccess);

        # Count the number of rows returned. This is important because if a full 30 are returned
        # we will display a more option

        $NumberOfRows = mysql_num_rows($SelectNameList);

        if ($NumberOfRows &gt;= 30) {
                $NextSetValue = $NextSet 1;
        }

        # Parse through the query and set up the menu items.
        while ($row = mysql_fetch_array($SelectNameList)) {
                $PersonNameList .= "n";
                        $PersonNameList .= "";
                                $PersonNameList .= $row["description"];
                                if ($row["first_name"]) $PersonNameList .= ", " . $row["first_name"];
                        $PersonNameList .= "n";
                        $PersonNameList .= "";
                                $PersonNameList .= "$Server/PhoneDirectory.php?";
                                $PersonNameList .= "ID=";
                                $PersonNameList .= $row["id"];
                                $PersonNameList .= "n";
                $PersonNameList .= "n";
        }

        # If we set NextSetValue above then we will display the more option. Which sets NextSet
        if ($NextSetValue) {
                $PersonNameList .= "n";
                        $PersonNameList .= "MOREn";
                        $PersonNameList .= "$Server/PhoneDirectory.php?NextSet=$NextSetValuen";
                $PersonNameList .= "n";
        }
        $PersonNameList .= "";
        echo "$PersonNameList";
}
?&gt;
</code></pre>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">jeff</span></span>

      








  


<time datetime="2009-05-14T00:00:00-04:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/categories/hacks/'>Hacks</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://jbuchbinder.com/2009/05/14/trixbox-directory-with-cisco-phones/" data-via="jbuchbinder" data-counturl="http://jbuchbinder.com/2009/05/14/trixbox-directory-with-cisco-phones/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2009/04/17/congratulations-were-finally-an-adult-nation/" title="Previous Post: Congratulations! We&#8217;re finally an adult nation!">&laquo; Congratulations! We&#8217;re finally an adult nation!</a>
      
      
        <a class="basic-alignment right" href="/2009/05/19/private-health-insurace-will-damn-us-all/" title="Next Post: Private health Insurace will damn us all">Private health Insurace will damn us all &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2014/05/07/48-hours-with-the-blackmagic-production-camera-4k/">48 Hours With the Blackmagic Production Camera 4K</a>
      </li>
    
      <li class="post">
        <a href="/2014/03/18/came-06-blackmagic-cage-review/">CAME-06 Blackmagic Cage Review</a>
      </li>
    
      <li class="post">
        <a href="/2014/03/16/first-look-at-the-blackmagic-production-camera-4k/">First Look at the Blackmagic Production Camera 4K</a>
      </li>
    
      <li class="post">
        <a href="/2013/12/21/lens-selection-for-cinematography/">Lens Selection for Cinematography</a>
      </li>
    
      <li class="post">
        <a href="/2013/11/28/dynamic-range/">Dynamic Range</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/categories/android-development/'>Android Development (1)</a></li>
<li class='category'><a href='/categories/cinematography/'>Cinematography (17)</a></li>
<li class='category'><a href='/categories/development/'>Development (34)</a></li>
<li class='category'><a href='/categories/film/'>Film (1)</a></li>
<li class='category'><a href='/categories/freemed/'>FreeMED (24)</a></li>
<li class='category'><a href='/categories/hacks/'>Hacks (28)</a></li>
<li class='category'><a href='/categories/maemo-n800-/'>Maemo (N800) (1)</a></li>
<li class='category'><a href='/categories/music/'>Music (14)</a></li>
<li class='category'><a href='/categories/opinion/'>Opinion (12)</a></li>
<li class='category'><a href='/categories/photography/'>Photography (10)</a></li>
<li class='category'><a href='/categories/remember-no-one-cares/'>Remember, No One Cares (81)</a></li>
<li class='category'><a href='/categories/reviews/'>Reviews (2)</a></li>
<li class='category'><a href='/categories/video-and-animation/'>Video and Animation (3)</a></li>

  </ul>
</section>
<section>
  <h1>Links</h1>
  <ul>
    <li><a href="https://crated.com/jbuchbinder">Crated Photo Prints</a></li>
    <li><a href="http://www.flickr.com/photos/whatsyourmeme/">Flickr Photos</a></li>
    <li><a href="http://redlinedoc.com/">Redline Doc</a></li>
    <li>
        <a href="http://shootthemoonfilms.com/">Shoot the Moon Films</a>
        <a href="http://www.facebook.com/ShootTheMoonFilms"><span class="socicon">b</span></a>
        <a href="http://www.twitter.com/STM_Films"><span class="socicon">a</span></a>
        <a href="http://www.youtube.com/ShootTheMoonVideos"><span class="socicon">r</span></a>
    </li>
    <li><a href="http://www.facebook.com/JeffreyBuchbinderFilm">Facebook Fan Page</a></li>
    <li><a href="http://twitter.com/jbuchbinder">Twitter Feed</a></li>
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/jbuchbinder">@jbuchbinder</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jbuchbinder',
            count: 10,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/whatsyourmeme?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/whatsyourmeme">My Delicious Bookmarks &raquo;</a></p>
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/102632982740363465802?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - jeff -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jbuchbinder';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  //js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  js.src = "//connect.facebook.net/en_US/all.js#appId=159544250739435&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
