
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>IMAP Synchronization - /home/jeff/blog</title>
  <meta name="author" content="jeff">

  
  <meta name="description" content="I hate it. IMAP Synchronization, that is. In an effort to migrate users from one *shudder* Exchange provider to another (after getting shot down for &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jbuchbinder.com/2010/01/17/imap-synchronization">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="/home/jeff/blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<meta property="fb:app_id" content="159544250739435" />


  
  <!-- Google Analytics -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-49191923-1', 'auto');  // Replace with your property ID.
  ga('send', 'pageview');

  </script>
  <!-- End Google Analytics -->


  <meta property="og:url" content="http://jbuchbinder.com/2010/01/17/imap-synchronization/">
<meta property="og:type" content="website" />

<meta property="og:title" content="IMAP Synchronization">
<meta property="og:description" content="">
 


</head>

<body   >
  <!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MXV2JN"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MXV2JN');</script>
<!-- End Google Tag Manager -->

  <header role="banner"><hgroup>
  <h1><a href="/">/home/jeff/blog</a></h1>
  
    <h2>Sucking away valuable moments of your life ...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jbuchbinder.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/music">Music</a></li>
  <li><a href="/pets">Pets</a></li>
  <li><a href="/quotes">Quotes</a></li>
  <!-- <li><a href="/studio">Studio</a></li> -->
  <li><a href="/wishlist">Wishlist</a></li>
  <li><a href="/in-memoriam">In Memoriam</a></li>
  <li><a href="/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">IMAP Synchronization</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-17T00:00:00-05:00" pubdate data-updated="true"></time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>I hate it. IMAP Synchronization, that is.</p>

<p>In an effort to migrate users from one *shudder* Exchange provider to another (after getting shot down for proposing first Zimbra, then standard mail server stuff, then <a href="http://www.openchange.org/">Openchange</a>), I have been going through all of the available IMAP sync software that I could find.</p>

<p><strong>mbsync</strong> () – We use this for IMAP backup, so I figured it would be a good idea to try it for syncing between two IMAP servers. *Crash*. *Segfault*. This is one of the reasons I’m not a big fan of really low-level apps written in C.</p>

<p><strong>imapsync</strong> () – Written using a Perl library, this offered the promise of fast syncing, and appeared to work in test runs. That is, until it encountered folders with spaces in them, and threw up all over the terminal. Really, it wasn’t a use-case for *anyone* to have spaces in folder names? I could have put some effort into fixing the library and/or script, but I figured that if something that basic wasn’t working for a fairly mature library, this wasn’t going to be pretty.</p>

<p><strong>The Imap Migration Tool</strong> () – Written in PHP, with a two or three step process. Was meant for moving stuff, not keeping them in sync, so running multiple times would cause additional copies of messages to be created. Also, it seems to have been written in some prehistoric form of PHP, which required hacking to get it even marginally functional. Even then, it spat tons of warnings and nasties, which made me a little nervous to use it on any important mailboxes.</p>

<p><strong>mailsync</strong> () – I don’t even remember why this one didn’t work, only that I wasted a fair amount of time playing with it to get it to try to migrate using the scheme we were working with to no avail. Scratch another one.</p>

<p>Solution … I had to roll my own. This is *stupid* to the highest degree, but I rolled something using <a href="http://java.sun.com/products/javamail/">javamail</a> into a self-contained “fat jar” using <a href="http://fjep.sourceforge.net/">fatjar</a>. It works sickeningly well, and actually respects existing messages by message id, so that if for any reason I have to break the sync process, it’ll skip past anything it has already done. I made it non-destructive because it seemed like seriously bad juju to have a sync tool purge out email…. If I get permission from work, I’ll post the jar for anyone with Java 1.6 to use.</p>

<p>As an aside, it took a little bit of hackery to get fatjar running outside eclipse. The relevant section of build.xml was:</p>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">jeff</span></span>

      








  


<time datetime="2010-01-17T00:00:00-05:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/categories/development/'>Development</a>, <a class='category' href='/categories/hacks/'>Hacks</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://jbuchbinder.com/2010/01/17/imap-synchronization/" data-via="jbuchbinder" data-counturl="http://jbuchbinder.com/2010/01/17/imap-synchronization/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2010/01/12/exposing-soap-services-with-apaches-proxypass/" title="Previous Post: Exposing SOAP Services with Apache&#8217;s ProxyPass">&laquo; Exposing SOAP Services with Apache&#8217;s ProxyPass</a>
      
      
        <a class="basic-alignment right" href="/2010/01/22/backing-up-mapi-contacts-and-calendar-from-exchange-server/" title="Next Post: Backing up MAPI contacts and calendar from Exchange Server">Backing up MAPI contacts and calendar from Exchange Server &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2014/03/18/came-06-blackmagic-cage-review/">CAME-06 Blackmagic Cage Review</a>
      </li>
    
      <li class="post">
        <a href="/2014/03/16/first-look-at-the-blackmagic-production-camera-4k/">First Look at the Blackmagic Production Camera 4K</a>
      </li>
    
      <li class="post">
        <a href="/2013/12/21/lens-selection-for-cinematography/">Lens Selection for Cinematography</a>
      </li>
    
      <li class="post">
        <a href="/2013/11/28/dynamic-range/">Dynamic Range</a>
      </li>
    
      <li class="post">
        <a href="/2013/11/19/signal-to-noise-ratio/">Signal to Noise Ratio</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/categories/android-development/'>Android Development (1)</a></li>
<li class='category'><a href='/categories/cinematography/'>Cinematography (16)</a></li>
<li class='category'><a href='/categories/development/'>Development (34)</a></li>
<li class='category'><a href='/categories/film/'>Film (1)</a></li>
<li class='category'><a href='/categories/freemed/'>FreeMED (24)</a></li>
<li class='category'><a href='/categories/hacks/'>Hacks (28)</a></li>
<li class='category'><a href='/categories/maemo-n800-/'>Maemo (N800) (1)</a></li>
<li class='category'><a href='/categories/music/'>Music (14)</a></li>
<li class='category'><a href='/categories/opinion/'>Opinion (12)</a></li>
<li class='category'><a href='/categories/photography/'>Photography (10)</a></li>
<li class='category'><a href='/categories/remember-no-one-cares/'>Remember, No One Cares (81)</a></li>
<li class='category'><a href='/categories/reviews/'>Reviews (2)</a></li>
<li class='category'><a href='/categories/video-and-animation/'>Video and Animation (3)</a></li>

  </ul>
</section>
<section>
  <h1>Links</h1>
  <ul>
    <li><a href="http://www.flickr.com/photos/whatsyourmeme/">Photos @ Flickr</a></li>
    <li><a href="http://irv.ourexchange.net/">Redline Doc</a></li>
    <li>
        <a href="http://shootthemoonfilms.com/">Shoot the Moon Films</a>
        <a href="http://www.facebook.com/ShootTheMoonFilms"><img src="/images/facebook-icon.png" height="16" width="16" alt="[Facebook]" /></a>
        <a href="http://www.twitter.com/STM_Films"><img src="/images/twitter-icon.png" height="16" width="16" alt="[Twitter]" /></a>
    </li>
    <li><a href="http://www.facebook.com/JeffreyBuchbinderFilm">Facebook Fan Page</a></li>
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/jbuchbinder">@jbuchbinder</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jbuchbinder',
            count: 10,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/whatsyourmeme?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/whatsyourmeme">My Delicious Bookmarks &raquo;</a></p>
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/102632982740363465802?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - jeff -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jbuchbinder';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  //js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  js.src = "//connect.facebook.net/en_US/all.js#appId=159544250739435&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
